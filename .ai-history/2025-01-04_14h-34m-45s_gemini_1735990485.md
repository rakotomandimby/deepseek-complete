# Propose completion from the random sentence generator

The final goal of this project is to be a code completion plugin that uses the DeepSeek API to suggest completions.
But we are not going to implement all in one go.
We are to make it step by step.

## Step 1: Generate a random sentence

in `./lua/rktmb-deepseek-complete.lua`, there is a function called `generate_sentence()`.

That function generates a random sentence.

## Step 2: Suggest a completion from a random sentence when triggered.

I want that when I am in a buffer, if I issue the command `:DeepSeekComplete`,
then the plugin should suggest a completion from the random sentence generator.

Tell me what code to put in what file in order to achieve that.




# This is gemini-2.0-flash-thinking-exp answer (0k in, 0k out)

Okay, here's how you can modify your files to achieve the desired functionality:

```lua
-- lua/rktmb-deepseek-complete.lua
local M = {}

-- Function to generate a random sentence
function M.generate_sentence()
  local sentences = {
    "The quick brown fox jumps over the lazy dog.",
    "The five boxing wizards jump quickly.",
    "Pack my box with five dozen liquor jugs.",
    "How vexingly quick daft zebras jump.",
    "Pack my box with five dozen liquor jugs.",
    "How vexingly quick daft zebras jump.",
    "What do you get if you multiply six by nine.",
    "If six is nine, what do you get?",
    "If six is nine, what do you get?",
    "I'm not a number, I'm a free man.",
    "I'm not a number, I'm a free man.",
    "Hey, I'm a free man. What do you get if you multiply six by nine?",
    "Hey, I'm a free man. What do you get if you multiply six by nine?",
  }
  return sentences[math.random(#sentences)]
end

-- Function to provide completion candidates
function M.complete()
    local sentence = M.generate_sentence()
    local words = {}
    for word in sentence:gmatch("%%%%S+") do
        table.insert(words, word)
    end

    local completions = {}
    for _, word in ipairs(words) do
        table.insert(completions, { word = word, kind = "random sentence" })
    end
    return completions
end


return M
```

```lua
-- plugin/init.lua
local rktmb_deepseek_complete = require("rktmb-deepseek-complete")

vim.api.nvim_create_user_command("DeepSeekComplete", function()
    local completions = rktmb_deepseek_complete.complete()
    local line = vim.api.nvim_get_current_line()
    local cursor_pos = vim.api.nvim_win_get_cursor(0)[2]

    vim.fn.complete(cursor_pos, completions)

end, {})
```

**Explanation of Changes:**

* **`lua/rktmb-deepseek-complete.lua`**:
    * Added a new function `M.complete()`. This function calls `M.generate_sentence()` to get a random sentence.  It then splits the sentence into words and formats each word as a completion item with a `word` and `kind` field.  This format is expected by the `vim.fn.complete()` function.
* **`plugin/init.lua`**:
    * Requires the `rktmb-deepseek-complete` module.
    * Creates a user command `:DeepSeekComplete`.  When executed, this command:
        * Calls `rktmb_deepseek_complete.complete()` to get the completion candidates.
        * Gets the current line and cursor position.
        * Uses `vim.fn.complete(cursor_pos, completions)` to trigger the completion menu with the generated completions.


Now, when you type `:DeepSeekComplete` in normal mode, you should see a completion popup with words from a random sentence.  This sets the stage for integrating with the DeepSeek API in the next steps.

