# Propose completion from the random sentence generator

The final goal of this project is to be a code completion plugin that uses the DeepSeek API to suggest completions.
But we are not going to implement all in one go.
We are to make it step by step.

## Step 1: Generate a random sentence

in `./lua/rktmb-deepseek-complete.lua`, there is a function called `generate_sentence()`.

That function generates a random sentence.

## Step 2: Suggest a completion from a random sentence when triggered.

I want that when I am in a buffer and in INSERT mode, if I issue the key sequence `<C-c>`,
then the plugin should suggest to complete the current word with a random sentence picked from the list of sentences. The suggestion text must appear in grey.

Tell me what code to put in what file in order to achieve that.




# This is gemini-2.0-flash-thinking-exp answer (0k in, 0k out)

```lua
-- lua/rktmb-deepseek-complete.lua
local M = {}

-- Function to generate a random sentence
function M.generate_sentence()
  local sentences = {
    "The quick brown fox jumps over the lazy dog.",
    "The five boxing wizards jump quickly.",
    "Pack my box with five dozen liquor jugs.",
    "How vexingly quick daft zebras jump.",
    "Pack my box with five dozen liquor jugs.",
    "How vexingly quick daft zebras jump.",
    "What do you get if you multiply six by nine.",
    "If six is nine, what do you get?",
    "If six is nine, what do you get?",
    "I'm not a number, I'm a free man.",
    "I'm not a number, I'm a free man.",
    "Hey, I'm a free man. What do you get if you multiply six by nine?",
    "Hey, I'm a free man. What do you get if you multiply six by nine?",
  }
  return sentences[math.random(#sentences)]
end

return M
```

```lua
-- plugin/init.lua
local rktmb_deepseek_complete = require("rktmb-deepseek-complete")

vim.api.nvim_create_autocmd("InsertEnter", {
    pattern = "*",
    callback = function()
        vim.keymap.set("i", "<C-c>", function()
            local current_line = vim.api.nvim_get_current_line()
            local current_col = vim.api.nvim_win_get_cursor(0)[2]
            local current_word = vim.fn.expand("<cword>")

            local suggestion = rktmb_deepseek_complete.generate_sentence()

            vim.fn.complete(current_col, {
                { word = suggestion, kind = "random sentence", menu = "[random]", icase = 1, abbr = current_word }
            })
        end, { noremap = true, expr = true, silent = true })
    end
})

vim.api.nvim_create_autocmd("InsertLeave", {
    pattern = "*",
    callback = function()
        vim.keymap.del("i", "<C-c>")
    end
})

```

Explanation of changes:

* **`plugin/init.lua`**: This file now uses the `rktmb-deepseek-complete` module.
* **Autocommands**:  Autocommands are used to set up and tear down the keymapping.  `InsertEnter` sets up the mapping when entering insert mode, and `InsertLeave` removes it when leaving insert mode. This prevents conflicts with other plugins and keeps the mapping local to insert mode.
* **Keymapping**: The `<C-c>` keymap in insert mode now calls a function.
* **Completion**: Inside the keymap function:
    * `vim.fn.expand("<cword>")` gets the current word being typed.
    *  `rktmb_deepseek_complete.generate_sentence()` gets a random sentence.
    * `vim.fn.complete()` is used to trigger the completion menu.  The `menu` field adds "[random]" to the completion item, and the abbr field makes the completion show up even if the user hasn't typed the full sentence yet.  `icase = 1` makes the matching case-insensitive.



This setup ensures the completion is triggered only in insert mode and uses the random sentence generator.  The completion menu will show the "[random]" tag and complete based on the current word being typed.
