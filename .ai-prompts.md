# Propose inline suggestions from DeepSeek API

The final purpose of this project is to be an inline suggestion plugin that uses the DeepSeek API to suggest completions.

I already have some pieces of code.
I need you to generate the missing parts.

## Step 1: Get the text from the beginning of the current buffer to the cursor

The cursor position is a tuple of (row, column), where row is the line number and column is the character position within the line.
The code to get the text from the beginning of the current buffer to the cursor is `./lua/rktmb-deepseek-complete.lua` function `M.get_text_before_cursor()`.

## Step 2: Get the text from the cursor to the end of the current buffer

In `./lua/rktmb-deepseek-complete.lua` I created the function `M.get_text_after_cursor()` 
that returns the text from the cursor to the end of the current buffer.

## Step 3: Query the DeepSeek API

When the user presses `<M-ESC>`, the function `suggest()` is called. That is the behavior I want.
Also, now, if in INSERT mode and the user presses the space key, `suggest()` is called.

That is the behavior I want.

## Step 4: Insert the suggestion as extmark

Now I want to insert the returned by the DeepSeek API as an extmark.

The extmark will start after the cursor position, NOT at the end of the line.

We will use the `nvim_buf_set_extmark()` function to do that.

The DeepSeek API response is a multiline string, so there might be a processing step to split it into lines.

Tell me what modifications I need to make to the code in order to achieve that.

# Invalid `end_row` : out of range

When `M.set_suggestion_extmark()` is called with the suggestion returned by the DeepSeek API, I get the following error:

```
Error executing vim.schedule lua callback : rktmb-deepseek-complete.lua:57: Invalid `end_row` : out of range
```

I have no data sample to reproduce this error, may be you can find it out.
Analyze the code and tell me what actions should be made.

